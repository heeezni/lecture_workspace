<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë² ë„¤ì¹˜ì•„ íƒ€ìê²Œì„</title>
    <style>
        #wrapper{
            width: 1250px;
            height: 700px;
            margin: auto;
            overflow: hidden;
        }
        #aside{
            width: 150px;
            height: 100%;
            background-color: peachpuff;
            float: left;
            text-align: center;
        }
        button {
            width: 130px;
            height: 30px;
            color: tomato;
            font-weight: bold;
            font-size: 20px;
        }
        #content{
            width: 1100px;
            height: 100%;
            float: left;
            background-image: url(../images/ë² ë„¤ì¹˜ì•„/ë² ë„¤ì¹˜ì•„.jpg);
            background-size: 1100px 700px;
            position: relative;
        }
        #content span{
            background-color:yellow;
        }
        #box{
            width: 150px;
            height: 150px;
            background-color: honeydew;
            position: relative;
            margin-top: 20px;
        }
    </style>
    <script src="./js/Word.js"></script>
    <script src="../js_lib/common.js"></script>
    <script src="./js/HP.js"></script>
    <script>
        let wordArray; //í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œë  ë•Œê¹Œì§€ ì´ 4ë ˆë²¨ê¹Œì§€ ê²Œì„ê°€ëŠ¥í•œ
                     //ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë‹´ê³ ìˆì„ ì „ì—­ë³€ìˆ˜
        let st; //interval undifined ìƒíƒœ
        let wordList=[]; //ë‹¨ì–´ ìŠ¤íŠ¸ë§ ìì²´ê°€ ì•„ë‹Œ, ë‹¨ì–´ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ ë‹´ê²¨ì§ˆ ë°°ì—´
        let speed=200; //ê²Œì„ì˜ ì†ë„ë¥¼ ì¢Œìš°í•˜ëŠ” ë³€ìˆ˜(ë ˆë²¨ì´ ì˜¬ë¼ê°ˆìˆ˜ë¡ ìˆ«ì ê°ì†Œ)
        let level=0; //ëª‡ë²ˆ ì§¸ ë°°ì—´ì„ ì ‘ê·¼(ì¸µìˆ˜ì ‘ê·¼)í•  ì§€ë¥¼ ê²°ì •
        let hpArray=[]; //HPì¸ìŠ¤í„´ìŠ¤ë¥¼ ë³´ê´€í•  ë°°ì—´

        //í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì—ì„œ ë©”ëª¨ì¥ì˜ ë°ì´í„°ë¥¼ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ,
        //ë©”ëª¨ì¥ íŒŒì¼ì„ ì½ì–´ë“¤ì—¬, ê·¸ ê²°ê³¼ë¬¼ì¸ JSONë¬¸ìì—´ì„ parsingí•œ í›„
        //ê°ì²´ë¡œ ë°˜í™˜ë°›ì•„ì„œ ì‚¬ìš©í•˜ì
        //ë‹¨ íŒŒì¼ì— ëŒ€í•œ ì ‘ê·¼ì€ jsê°€ ë¶ˆê°€ëŠ¥ í•˜ë¯€ë¡œ 
        //í¬ë¡¬ë¸Œë¼ìš°ì €ê°€ ì‚¬ìš©ìì—ê²Œ ìˆ˜ë½ì„ ë°›ì€ ê·¸ ê²°ê³¼ë¥¼ ì–»ì–´ì™€ì„œ ì²˜ë¦¬í•´ì•¼ í•¨
        function loadData(e){
            //console.log(e);
            let file=e.target.files[0]; //ì‚¬ìš©ìê°€ ìˆ˜ë½í•œ ê·¸ íŒŒì¼

            //íŒŒì¼ì˜ ë‚´ìš© ì½ê¸°
            let reader=new FileReader();
            
            reader.onload=function(data){ //dataëŠ” ë‹¤ ì½ì–´ë“¤ì¸ ê²°ê³¼ë¬¼
                //console.log("ë©”ëª¨ì¥ ì½ì€ ê²°ê³¼ëŠ”", data);
                let jsonString=data.target.result; //ë©”ëª¨ì¥ì— ì‘ì„±ëœ ë°”ë¡œ ê·¸ ë¬¸ìì—´ë“¤
                let obj=JSON.parse(jsonString); //ë¬¸ìì—´ì´ë¯€ë¡œ íŒŒì‹±í•˜ê¸°

                //console.log(obj);

                wordArray=obj.wordList; //ì „ì—­ë³€ìˆ˜ì˜ ë³´ê´€
                createWord();
            }
            reader.readAsText(file); //ë¬¸ì„œ íŒŒì¼ì´ê¸° ë•Œë¬¸ì— readAsTextì„ íƒ
        }
        function createWord(){
            for(let i=0; i<wordArray[level].length; i++){
                let word=new Word(document.getElementById("content"),100+(i*100),getRandomByRange(-300,300),wordArray[level][i],"red");
                wordList.push(word);
            }
        }
        function nextStep(){
            //ëª¨ë“  ë‹¨ì–´ë¥¼ ëŒ€ìƒìœ¼ë¡œ tick(),render(),
            for(let j=0; j<wordList.length; j++){
                wordList[j].tick();
                wordList[j].render();
            }
        }
        //ë‹¨ì–´ë¥¼ ì•Œì•„ë§íˆëŠ” ê³¼ì •ì—ì„œ wordListì˜ ê¸¸ì´ê°€ 0ì— ë„ë‹¬í•˜ë©´
        //ì´ íŒì„ ë‹¤ í´ë¦¬ì–´í–ˆë‹¤ê³  íŒë‹¨í•˜ì—¬ ë ˆë²¨ì„ ì˜¬ë¦¬ê¸°
        function checkLevel(){
            if(wordList.length==0){
                alert("ë ˆë²¨ "+(level+1)+"ë‹¨ê³„ í†µê³¼ë¥¼ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤!");
                level++
                speed-=200;

                createWord();
            }
        }
                       
        //ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë‹¨ì–´ ë¹„êµí•´ì„œ ì œê±° ë“±ì˜ ì²˜ë¦¬
        function checkText(obj){

            //í™”ë©´ì˜ ë°°ì—´ ìˆ˜ë§Œí¼ ë¹„êµ
            for(let i=0; i<wordList.length; i++){
               if(wordList[i].text==obj.value){

                //ì œê±°í•˜ê¸° (í™”ë©´ì—ì„œ ì œê±°+ë°°ì—´ì—ì„œë„ ì œê±°)
                let content=document.getElementById("content");
                content.removeChild(wordList[i].span);

                wordList.splice(i,1);
                obj.value ="";
                
                checkLevel();//ë ˆë²¨ì˜¬ë ¤ì•¼í•˜ëŠ”ì§€ í•¨ìˆ˜ì— ë§¡ê¸°ê¸°
                return; //ë§ì¶”ë©´ í•¨ìˆ˜ ì¢…ë£Œ
               }  
            }
            if(hpArray.length>0){
            let box=document.getElementById("box");
            box.removeChild(hpArray[0].div);
            hpArray.splice(0,1);

            }
            if(hpArray.length == 0) {
            clearInterval(st);
            alert("Game Over ğŸ˜¢ ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.");
            }

            obj.value ="";
        }
        //9ê°œì˜ HPì¸ìŠ¤í„´ìŠ¤ ìƒì„±í•˜ê¸°
        function createHP(){
            for(let i=0; i<3; i++){
                for(let j=0; j<3; j++){
                    hpArray.push(new HP(document.getElementById("box"),50*j,50*i,47,47,"red","black"));
                }
            }
        }

        function gameLoop(){
            //console.log("ì € gameLoopì¤‘ì´ì—ìš”");
            nextStep(); //ë‹¨ì–´ê°€ ë‚´ë ¤ì˜¤ê²Œ
        }

        function init(){
            document.querySelector("input[type=file]").addEventListener("change",function(e){
                loadData(e);
            });
            document.querySelector("#aside button").addEventListener("click", function(){
                if(st==undefined){//ê°€ë™ëœ ì¸í„°ë²Œì´ ì—†ë‹¤ë©´
                    st=setInterval(gameLoop, speed);
                    this.innerText="Pause";
                }else{
                    clearInterval(st);
                    st=undefined; //ì‚­ì œ í›„ ë‹¤ì‹œ ì´ˆê¸°í™”
                    this.innerText="Start!";
                }
            });
            document.querySelector("#aside input[type='text']").addEventListener("keyup",function(e){
                if(e.keyCode==13){ //ì—”í„°ë¥¼ ì³¤ë‹¤ë©´
                    //ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë‹¨ì–´ì™€ í™”ë©´ì— ìƒì¡´í•´ìˆëŠ” ë‹¨ì–´ ì¸ìŠ¤í„´ìŠ¤ ë‚´ë¶€ì˜
                    //spanì˜ innerTextë¥¼ ë¹„êµí•˜ì
                    checkText(this);
                }
            });
            createHP(); //ì—ë„ˆì§€ ìƒì„±
        }

        addEventListener("load",function(){
            init();
        });

    </script>
</head>
<body>
    <div id="wrapper">
        <div id="aside">
            <input type="file">
            <button>Start!</button>
            <input type="text" placeholder="ë‹¨ì–´ì…ë ¥">
            <div id="box"></div>
        </div>
        <div id="content">
        </div>
    </div>
</body>
</html>

